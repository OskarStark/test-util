language: php

sudo: false

env:
  global:
    - secure: "Gu151R2/aWRaQN6TQsmITbs0MTQacA/ucDfq/JwOk7j5qGCtv7U/lPfGdkXwZ4KYl3tBU4juivy2cbzGsC6D/mhid/jS58ZRsf336/5XhWFTww31UKud5Q44oyJLMOjNkC/WoGdIRcBDef9yyPS8R4R8y+R1oBOu2mEI8HwApU4rlLFpDDeTyVM89ZR4rodfig9nY1Xg6xbdRVtoPRz97SRgZvx7QZKRBWy3zaZN3ltAMqIcUVh5eG6YimCYt20oIXRkYBDVYEDvxAzaajAUMcG1spQTjZzEcig4uyeod2Mgs4Q4aQrNKbxx0FDblrJp/q15i9zpVAck11fvCU8wMWAE2SSmCnwRymi9wJDEpyEosTU3wHC46iZ6F6BXw6rZTnTgub8PD0uin0qeDEOg6p9qVP3vt9nqJkGmqwyHYJtev1I61gpud35DehmAIGX3TbM9YF1aqnBSCy5EtQ0Pg2xqHTVPYkuD6zlTn1xsQ9Rhj4kRSl9ES4XgyBxhZmvCT+jMn9Ud0jF8TMt+GTZQhnYPZRjorLZA73KPRMUALoHAOWvzPF59ZfdO8nBtXmckg5YW3QtIYGS4Wg65TDUGtH0SyfyH8/UMh18BJiqtRqnH7qv3T6r0KDheZfWlfQQwHv6YweNKocpwj0PYrUZHZXEfTYWT0YdDLttLvVjCsxs="
    - secure: "fw5Dh45elta+tqBlwa6gcBnU9huGzqHQUMRoZXUV+e2Dse4UmMMH4OYz7mAwV9CU+jWaCROXkSP4uC6ljkS3NfnByfaCehv9WIlIWOGdzVjCMvj7XF93QFEopb9aIyMEPasRZe7tHBi6UK1LPl4IOTNzoZ4DLiIMIvKnl9K4KOHZ6dLRVPnxcxvCae6vFWi5rliaQqe5e1Av86uyS0BBPfEIpYRRQJ1u88k2IfOLn/liXb0QRNbiToiMTPZ5cEwbBBwePe3wSzYhjZBR1vrMqOpdFstlzZsCaCDEViMbEhcPafKNDMYLY7z5jjT0W2nsCoIIdGI7GJCWQKQW/jWxPyvY8rXQ9T6eKLZb8zSjaZhKhf78KCDK2dWZcRVBktbXcZJyEtkIOeaP64JZBflSmlJHWZZZ5JbeEAfZvmd0s+zjalAnmcQLdp/6H6Fzn1cdI+TfZMcPGTwDLz90clrjKcePaBph8fUj871tp5+cDeFNHdE3j6JfAJkgAJ/rHI7p4KcE2ze3bBSPpeuQB2GQ8J5c6ZMWv/rGRT0nJUFhyvtS/IFIW9YjlaliXGvPVm+kq+vqFdXj5KEkbAeVPnPkDsTm6Ej2E9AsE6i0eqimVjO1D5syoI8GQ30mK6IK1wzPCxPN9BE4buEZJSkc3F7+rvR3qigGf8QERwuWF1FieuU="

matrix:
  include:
    - php: 7.0
      env: WITH_LOWEST=true
    - php: 7.0
      env: WITH_LOCKED=true WITH_CS=true
    - php: 7.0
      env: WITH_HIGHEST=true
    - php: 7.1
      env: WITH_LOWEST=true
    - php: 7.1
      env: WITH_LOCKED=true WITH_COVERAGE=true
    - php: 7.1
      env: WITH_HIGHEST=true

cache:
  directories:
    - $HOME/.composer/cache
    - $HOME/.php-cs-fixer

before_install:
  - source .travis/xdebug.sh
  - xdebug-disable
  - composer validate
  - composer config github-oauth.github.com $GITHUB_TOKEN

install:
  - if [[ "$WITH_LOWEST" == "true" ]]; then composer update --prefer-lowest; fi
  - if [[ "$WITH_LOCKED" == "true" ]]; then composer install; fi
  - if [[ "$WITH_HIGHEST" == "true" ]]; then composer update; fi

before_script:
  - mkdir -p "$HOME/.php-cs-fixer"
  - mkdir -p build/logs

script:
  - if [[ "$WITH_CS" == "true" ]]; then vendor/bin/php-cs-fixer fix --config=.php_cs --diff --dry-run --verbose; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-enable; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/phpunit --configuration=test/Unit/phpunit.xml --coverage-clover=build/logs/clover.xml; else vendor/bin/phpunit --configuration=test/Unit/phpunit.xml; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-disable; fi

after_success:
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/test-reporter --coverage-report=build/logs/clover.xml; fi

notifications:
  email: false
